<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adam Yanai</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF;
            color: #1a1a2e;
        }
        canvas { display: block; width: 100vw; height: 100vh; }

        .vertical-menu {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: row;
            gap: 25px;
            z-index: 10;
        }
        .vertical-menu a {
            background-color: transparent;
            color: #1a1a2e;
            padding: 0;
            border-radius: 0;
            text-decoration: none;
            font-size: 0.9em;
            text-align: center;
            transition: color 0.3s ease, transform 0.3s ease;
            box-shadow: none;
            border: none;
        }
        .vertical-menu a:hover {
            color: #888888;
            transform: translateY(-3px);
        }

        .slider-menu {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        .slider-menu-button {
            background-color: transparent;
            color: #1a1a2e;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .slider-menu-button.active {
            background-color: rgba(0, 0, 0, 0.1);
            color: #1a1a2e;
        }
        .slider-menu-button:not(.active):hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* Popup Window Styles */
        .popup-window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50vw;
            max-width: 600px;
            min-width: 300px;
            height: 60vh;
            min-height: 400px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 100;
            display: none; /* Hidden by default */
            flex-direction: column;
            resize: both;
            overflow: hidden;
        }
        .popup-header {
            width: 100%;
            height: 30px;
            background-color: #e0e0e0;
            cursor: move;
            display: flex;
            align-items: center;
            padding: 0 10px;
            border-bottom: 1px solid #ccc;
            flex-shrink: 0;
        }
        .popup-controls {
            display: flex;
            gap: 8px;
        }
        .popup-controls .control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .control-btn.close { background-color: #ff5f56; cursor: pointer; }
        .control-btn.minimize { background-color: #ffbd2e; }
        .control-btn.maximize { background-color: #27c93f; }

        #popup-title {
            flex-grow: 1;
            text-align: center;
            font-size: 0.9em;
            font-weight: 500;
            color: #333;
            margin-right: 36px; /* Offset for controls */
        }

        .popup-content {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #popup-image {
            width: 100%;
            max-height: 50%;
            object-fit: contain;
            border-radius: 4px;
        }
        #popup-description {
            font-size: 0.9em;
            line-height: 1.5;
            color: #333;
            margin-bottom: 5px;
        }
        #popup-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding-top: 10px;
            flex-shrink: 0;
        }
        #popup-links a img {
            height: 28px;
            width: auto;
            transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out;
            opacity: 0.8;
        }
        #popup-links a:hover img {
            transform: scale(1.1);
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="slider-menu">
        <button id="projectsButton" class="slider-menu-button">PROJECTS</button>
        <button id="artButton" class="slider-menu-button">ART</button>
        <button id="aboutButton" class="slider-menu-button">ABOUT</button>
    </div>

    <div class="vertical-menu">
        <a href="https://www.instagram.com/adamyanai/" target="_blank">IG</a>
        <a href="https://www.linkedin.com/in/adamyanai/" target="_blank">LI</a>
        <a href="https://github.com/adamyanai" target="_blank">GH</a>
        <a href="pdfs/resume.pdf" target="_blank">CV</a>
    </div>

    <div id="popup-window" class="popup-window">
        <div class="popup-header" id="popup-header">
            <div class="popup-controls">
                <span class="control-btn close" id="popup-close"></span>
                <span class="control-btn minimize"></span>
                <span class="control-btn maximize"></span>
            </div>
            <span id="popup-title">Project Title</span>
        </div>
        <div class="popup-content">
            <img id="popup-image" src="" alt="Project Image">
            <p id="popup-description">Project description goes here.</p>
            <div id="popup-links"></div>
        </div>
    </div>


    <script>
        // --- THREE.JS GLOBALS ---
        let scene, camera, renderer;
        let artGroup, projectGroup, aboutGroup;
        let isDragging = false;
        let previousMouseX = 0, previousMouseY = 0;
        let rotationSpeed = 0.005;
        let zoomSpeed = 0.1;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        // --- POPUP & DRAG GLOBALS ---
        let popup, header, isPopupDragging = false;
        let offsetX, offsetY;
        let mouseDownX = 0, mouseDownY = 0;
        let hasDragged = false;
        const dragThreshold = 5; // pixels

        // --- INITIALIZATION ---
        function init() {
            // Scene, Camera, Renderer Setup
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            renderer.setClearColor(0xFFFFFF);

            // Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);

            // Content Groups
            artGroup = new THREE.Group();
            projectGroup = new THREE.Group();
            aboutGroup = new THREE.Group();
            scene.add(artGroup, projectGroup, aboutGroup);

            // Populate Globes
            addPhotosToGlobe();
            addProjectsToGlobe();
            addAboutContent();

            // Initial Visibility
            artGroup.visible = false;
            projectGroup.visible = false;
            aboutGroup.visible = false;

             [artGroup, projectGroup, aboutGroup].forEach(group => {
                group.traverse(obj => {
                    if (obj.isMesh && obj.material) {
                        obj.material.opacity = 0;
                    }
                });
            });


            // Event Listeners
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('wheel', onMouseWheel);
            renderer.domElement.addEventListener('mouseleave', onMouseLeave);
            renderer.domElement.addEventListener('click', onCanvasClick);
            window.addEventListener('resize', onWindowResize);

            // Setup UI
            setupSliderMenu();
            setupPopupWindow();
        }

        // --- CONTENT CREATION ---

        function addImagesToGroup(group, items) {
            const globeRadius = 3;
            const textureLoader = new THREE.TextureLoader();

            items.forEach((item, i) => {
                textureLoader.load(item.imageUrl, (texture) => {
                    const aspectRatio = texture.image.width / texture.image.height;
                    const planeHeight = item.baseSize;
                    const planeWidth = item.baseSize * aspectRatio;

                    const geometry = new THREE.PlaneGeometry(planeWidth, planeHeight);
                    const material = new THREE.MeshBasicMaterial({
                        map: texture,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0
                    });
                    const mesh = new THREE.Mesh(geometry, material);

                    mesh.userData = item;

                    const phi = Math.acos(-1 + (2 * i) / items.length);
                    const theta = Math.sqrt(items.length * Math.PI) * phi;
                    mesh.position.setFromSphericalCoords(globeRadius, phi, theta);

                    group.add(mesh);
                }, undefined, (err) => {
                    console.error('An error happened loading the texture:', item.imageUrl, err);
                });
            });
        }

        function addPhotosToGlobe() {
            const artItems = [
                "images/africa.png", "images/airport.png", "images/arch.png", "images/archart.png",
                "images/bike.png", "images/intersect.png", "images/bikeart.png", "images/boats.png",
                "images/bottlesart.png", "images/boxes2art.png", "images/boxesart.png", "images/build.png",
                "images/buildart.png", "images/car.png", "images/carart.png", "images/celtics.png",
                "images/celticsart.png", "images/chairart.png", "images/chairplanart.png", "images/concert.png",
                "images/elephant.png", "images/glide.png", "images/glide2.png", "images/glide3.png",
                "images/glide4.png", "images/handsart.png", "images/horseart.png", "images/hotel.png",
                "images/magazineart.png", "images/mountainart.png", "images/mountainsart.png", "images/nyc.png",
                "images/paintingart.png", "images/paris.png", "images/paris2.png", "images/penart.png",
                "images/piecesart.png", "images/planes.png", "images/projectart.png", "images/protest.png",
                "images/selfart.png", "images/sf.png", "images/showcaseart.png", "images/sketch.png",
                "images/sunset.png", "images/tents.png", "images/vaca.png", "images/windows.png",
                "images/abercrombie.png", "images/bball.png", "images/bondi.png", "images/breakfast.png",
                "images/caterpillar.png", "images/coolrocks.png", "images/dogs.png", "images/drumoncar.png",
                "images/figureeight.png", "images/figuresjoseph.png", "images/fromhike.png", "images/fromhike2.png",
                "images/fromhike3.png", "images/fromhike4.png", "images/fromplane.png", "images/fromplaneref.png",
                "images/goingout.png", "images/goingout2.png", "images/japan1.png", "images/japan2.png",
                "images/japan3.png", "images/japan4.png", "images/japan5.png", "images/japan6.png",
                "images/japan7.png", "images/japan8.png", "images/japan9.png", "images/japan10.png",
                "images/japan11.png", "images/japan12.png", "images/japan13.png", "images/japan14.png",
                "images/japan15.png", "images/japan16.png", "images/japan17.png", "images/japan18.png",
                "images/japan19.png", "images/japan20.png", "images/jimmysrooftop.png", "images/josephdrone.png",
                "images/lanterns.png", "images/muginwindow.png", "images/nicecar.png", "images/nicerock.png",
                "images/operabar.png", "images/operahouse.png", "images/palmer.png", "images/pizzaplace.png",
                "images/rockforms.png", "images/rocksonbeach.png", "images/shanghai.png", "images/shanghai2.png",
                "images/shanghai3.png", "images/shanghai4.png", "images/shanghai5.png", "images/shanghai6.png",
                "images/shanghai7.png", "images/shanghai8.png", "images/shanghai9.png", "images/shanghai10.png",
                "images/shanghai11.png", "images/shanghai12.png", "images/shanghai13.png", "images/sydneyharbor.png",
                "images/tobeach.png", "images/treeindark.png", "images/weirdbird.png", "images/wowbeach.png"
            ].map(url => ({ imageUrl: url, baseSize: 0.7 }));
            addImagesToGroup(artGroup, artItems);
        }

        function addProjectsToGlobe() {
            const projectItems = [
                { title: "InView.ai - Face Detection Web App", imageUrl: "images/ec327.png", description: "For a software engineering course, my team and I created a web application that used the OpenCV library to detect faces. I was in charge of developing the entirety of the frontend, as well as incorporating our python script for face detection into the Flask framework to ensure that it worked seamlessly with the interface. Access the Github repository of the code and demo video by clicking on the Github and movie logos below.", baseSize: 0.8, links: { github: 'https://github.com/adamyanai/InView.ai-Face-Detection-Web-App', video: 'videos/inview.mp4' } },
                { title: "Countdown Timer: Verilog and FPGA", imageUrl: "images/ec311.png", description: "I was able to grow my range of coding abilities through a logic design course in which I learned how to program hardware with Verilog and implement it by using FPGA boards. This project for the course involved creating a countdown timer that converted binary inputs to decimal values in minute and second format, as shown above. Access the Github repository of the code and demo video by clicking on the Github and movie logos below.", baseSize: 0.8, links: { github: 'https://github.com/adamyanai/Countdown-Timer-w-FPGA-Integration', video: 'videos/ec311.mp4' } },
                { title: "Study of Correlation Between Human Development Index and Obesity Rates", imageUrl: "images/ek125c.png", description: "A highly impactful programming experience was a MATLAB-integrated research project for a programming course. The project was group-based, and I was responsible for the entirety of the coding. Access the full project report and the Github repository of the code by clicking on the PDF and Github logos below.", baseSize: 0.8, links: { pdf: 'pdfs/ek125.pdf', github: 'https://github.com/adamyanai/HDI-Data-Study' } },
                { title: "Computerized Truss Analysis", imageUrl: "images/truss.png", description: "Another impactful experience has been a portion of a project for a mechanics course in which I created a MATLAB script to analyze the internal forces of a truss design and approximate production costs based on the members and applied loads. This project was also group-based, and I was again responsible for the entirety of the coding. Access the full project report and the Github repository of the code by clicking on the PDF and Github logos below.", baseSize: 0.8, links: { pdf: 'pdfs/ek301.pdf', github: 'https://github.com/adamyanai/Truss-Design-Analysis' } },
                { title: "This Portfolio Website!", imageUrl: "images/atm.png", description: "I programmed this site using HTML, CSS, and JavaScript. Access the Github repository of the code by clicking on the Github logo below.", baseSize: 0.8, links: { github: 'https://github.com/adamyanai/Portfolio' } },
                { title: "Applications of Artificial Intelligence in Creative Problem Solving", imageUrl: "images/lscp.png", description: "I've explored the uses of Artificial Intelligence through a project about the creative problem-solving abilities of ChatGPT. I conducted a study to test ChatGPT's creative problem-solving abilities and presented the findings at the LSC 2023 Conference in Institut des Hautes Études Scientifiques (IHES) in Bures-sur-Yvette, France. Access the full project poster by clicking on the PDF logo below.", baseSize: 0.8, links: { pdf: 'pdfs/lsc.pdf' } },
                { title: "Stud. - Swipe, Study, Succeed.", imageUrl: "images/studlogo.png", description: "The key component of a business innovation course was a semester-long group project. Tasked with developing a viable business plan for a product, my team and I created 'Stud.', an app that facilitates finding study buddies and studying efficiently, similarly to how Tinder facilitates dating. Since the product idea was mine, I took responsibility for much of the project and led my team to place first (out of eight teams) in the final pitch competition. Access the slide deck and business plan by clicking on the PDF logos below.", baseSize: 0.8, links: { pdf1: 'pdfs/studslides.pdf', pdf2: 'pdfs/studreport.pdf' } },
                { title: "Temperature Monitor", imageUrl: "images/ek131b.png", description: "The following was another semester long project for a hands-on engineering course which focused on foundational engineering concepts and the importance of the design process. The goal of the project was to design and develop a digital thermometer through CAD modeling & 3D printing, circuit planning, soldering, and programming. Access the some project visuals by clicking on the PDF logo below.", baseSize: 0.8, links: { pdf: 'pdfs/ek131.pdf' } },
                { title: "The GoPan", imageUrl: "images/gopan.png", description: "Here's an ongoing project on generating heat through nothing but friction, inspired by the millions worldwide who lack steady access to electricity. GoPan was nominated for the James Dyson Award in 2024. Click the PDF logo below for more info.", baseSize: 0.8, links: { pdf: 'pdfs/heater.pdf' } },
                { title: "R.O.M. - Room Occupancy Monitor", imageUrl: "images/210.png", description: "For an engineering design course, my group and I developed a room occupancy tracking device using CAD modeling, 3D printing, circuit planning, soldering, and C++ programming. Our project was voted a stand-out project and selected to be displayed in the BU Engineering building. Access the full project report and demo video by clicking on the PDF and movie logos below.", baseSize: 0.8, links: { pdf: 'pdfs/romfinal.pdf', video: 'https://youtu.be/8yThHoSw6dg' } },
                { title: "Architectural Design", imageUrl: "images/archproj.png", description: "A 'cold-climate design' project that served as my introduction to the architectural process, from the first idea to the final prototype. Access a short breakdown of the project by clicking on the PDF logo below.", baseSize: 0.8, links: { pdf: 'pdfs/arch.pdf' } },
                { title: "'Calculus Controversy' Animation", imageUrl: "images/calcpic.png", description: "Here's a three minute educational-style video I created about the Isaac Newton and Gottfried Wilhelm Leibniz calculus debate. I made the video using Adobe Creative Cloud applications, including Animate and Audition. Click the film graphic below to watch the video.", baseSize: 0.8, links: { video: 'videos/calc.mp4' } },
                { title: "CAD 3D Modeling and Engineering Drawing Using SolidWorks", imageUrl: "images/assem.png", description: "I grew my engineering design abilities through a CAD and Machine Components course, for which I've made several CAD part models and respective drawings. Click the PDF logo below to view some examples, and the video logo to view an animation.", baseSize: 0.8, links: { pdf: 'pdfs/me357.pdf', video: 'videos/assem.mp4' } },
                { title: "Custom Drone Build", imageUrl: "images/drone.png", description: "A personal project that I'm currently working on is building a drone using some open source carbon fiber frame components and 3D printed toroidal propellers, as well as a Speedy Bee computing stack. Click on the PDF logo below to view some of the progress.", baseSize: 0.8, links: { pdf: 'pdfs/drone.pdf' } },
                { title: "Egg-Bot", imageUrl: "images/eggbot2.png", description: "My 'introduction to robotics' project was creating a robot fit for combat and exploration in uneven terrain. The design concept was that the robot would be able to overcome a variety of obstacles through its egg-shape, as it would be impossible to place it in a situation where it wouldn't be able to continue moving. Click on the PDF logo below to view some of more design information.", baseSize: 0.8, links: { pdf: 'pdfs/eggbotinfo.pdf' } },
                { title: "Machinery", imageUrl: "images/machineryex.png", description: "Through working at EPIC-BU as a lab assistant and then lab student leader, I was able to grow my product design skills. While assisting visitors at EPIC has helped me improve my previously-gained abilities - such as laser cutting and 3D printing - training in the use of subtractive manufacturing machinery - such as the mill and lathe - has opened up new possibilities for my creations.", baseSize: 0.8, links: { pdf: 'pdfs/machiningstuff.pdf' } }
            ];
            addImagesToGroup(projectGroup, projectItems);
        }

        function addAboutContent() {
             const globeRadius = 1.8;
            const noteSize = 0.9;
            const createStickyNoteTexture = (title, text, color, isIntro = false) => {
                const canvas = document.createElement('canvas');
                const size = 512;
                canvas.width = size;
                canvas.height = size;
                const context = canvas.getContext('2d');
                context.fillStyle = color;
                context.fillRect(0, 0, size, size);
                const gradient = context.createLinearGradient(0, 0, 0, size);
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(1, 'rgba(0,0,0,0.1)');
                context.fillStyle = gradient;
                context.fillRect(0, 0, size, size);
                context.fillStyle = '#333333';
                context.textAlign = 'center';
                context.textBaseline = 'top';
                const titleFontSize = 48;
                const bodyFontSize = isIntro ? 32 : 28;
                const bodyLineHeight = isIntro ? 40 : 34;
                const spaceBetween = 20;
                const lines = text.split('\n');
                const totalHeight = titleFontSize + spaceBetween + (lines.length * bodyLineHeight);
                let currentY = (size - totalHeight) / 2;
                context.font = `bold ${titleFontSize}px Inter`;
                context.fillText(title, size / 2, currentY);
                currentY += titleFontSize + spaceBetween;
                context.font = `${bodyFontSize}px Inter`;
                lines.forEach(line => {
                    context.fillText(line, size / 2, currentY);
                    currentY += bodyLineHeight;
                });
                return new THREE.CanvasTexture(canvas);
            };

            const aboutItemsUnshuffled = [
                { type: 'note', title: 'For Fun', text: 'Photography • Drawing\nVolleyball • Snowboarding\nRunning • Guitar', color: '#bbdefb', isIntro: true },
                { type: 'note', title: 'Education', text: "Computer Engineering @ BU ('26)\nExchange Semester @ USYD ('25)\nFine Arts @ LaGuardia HS ('22)", color: '#d1c4e9' },
                { type: 'note', title: 'Experience', text: "UI/UX Designer @ Stethy ('25)\nEng. Teaching Assistant @ BU ('24)\nSoftware Engineer @ Linguana ('24)\nLab Assistant @ BU ('23)", color: '#fce4ec' },
                { type: 'note', title: 'Cities', text: 'New York • Boston\nTel Aviv • Sydney', color: '#c8e6c9' },
                { type: 'note', title: 'Intro', text: "I'm Adam, a creative technologist\nand artist exploring the intersection\nof design, technology, and\nhuman experience.", color: '#fff9c4', isIntro: false },
                { type: 'photo', url: "images/boarding.png" }, { type: 'photo', url: "images/dragon.png" },
                { type: 'photo', url: "images/headstand.png" }, { type: 'photo', url: "images/sand.png" },
                { type: 'photo', url: "images/scuba.png" }, { type: 'photo', url: "images/skiface.png" },
                { type: 'photo', url: "images/skydiving.png" }, { type: 'photo', url: "images/skydiving2.png" },
                { type: 'photo', url: "images/surfing.png" }, { type: 'photo', url: "images/wow.png" },
                { type: 'photo', url: "images/bereal.JPG" },
            ];

            const firstItem = aboutItemsUnshuffled.shift();
            const shuffledItems = aboutItemsUnshuffled.sort(() => Math.random() - 0.5);
            const aboutItems = [firstItem, ...shuffledItems];

            const textureLoader = new THREE.TextureLoader();

            aboutItems.forEach((item, i) => {
                const phi = Math.acos(-1 + (2 * i) / aboutItems.length);
                const theta = Math.sqrt(aboutItems.length * Math.PI) * phi;

                if (item.type === 'note') {
                    const texture = createStickyNoteTexture(item.title, item.text, item.color, item.isIntro);
                    const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide, transparent: true, opacity: 0 });
                    const geometry = new THREE.PlaneGeometry(noteSize, noteSize);
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.rotation.z = (Math.random() - 0.5) * 0.2;
                    mesh.position.setFromSphericalCoords(globeRadius, phi, theta);
                    aboutGroup.add(mesh);
                } else { // 'photo'
                    textureLoader.load(item.url, (texture) => {
                        const baseHeight = 0.6;
                        const aspectRatio = texture.image.width / texture.image.height;
                        const geometry = new THREE.PlaneGeometry(baseHeight * aspectRatio, baseHeight);
                        const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide, transparent: true, opacity: 0 });
                        const mesh = new THREE.Mesh(geometry, material);
                        mesh.position.setFromSphericalCoords(globeRadius, phi, theta);
                        aboutGroup.add(mesh);
                    }, undefined, (err) => console.error('An error happened loading the texture:', item.url, err));
                }
            });
        }


        // --- ANIMATION & EVENT LISTENERS ---

        function animate() {
            requestAnimationFrame(animate);
            [artGroup, projectGroup, aboutGroup].forEach(group => {
                group.children.forEach(mesh => {
                    if (mesh.visible) mesh.lookAt(camera.position);
                });
            });
            renderer.render(scene, camera);
        }

        function onMouseDown(event) {
            if (event.target.closest('.popup-window')) return;
            isDragging = true;
            hasDragged = false;
            previousMouseX = event.clientX;
            previousMouseY = event.clientY;
            mouseDownX = event.clientX;
            mouseDownY = event.clientY;
            renderer.domElement.style.cursor = 'grabbing';
        }

        function onMouseUp(event) {
            if (!hasDragged) {
                onCanvasClick(event);
            }
            isDragging = false;
            renderer.domElement.style.cursor = 'grab';
        }

        function onMouseMove(event) {
            if (!isDragging) return;

            const deltaX = Math.abs(event.clientX - mouseDownX);
            const deltaY = Math.abs(event.clientY - mouseDownY);
            if (deltaX > dragThreshold || deltaY > dragThreshold) {
                hasDragged = true;
            }

            if (hasDragged) {
                const moveDeltaX = event.clientX - previousMouseX;
                const moveDeltaY = event.clientY - previousMouseY;
                scene.rotation.y += moveDeltaX * rotationSpeed;
                const newRotationX = scene.rotation.x + moveDeltaY * rotationSpeed;
                scene.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, newRotationX));
                previousMouseX = event.clientX;
                previousMouseY = event.clientY;
            }
        }

        function onMouseWheel(event) {
            event.preventDefault();
            camera.position.z += event.deltaY * zoomSpeed * 0.01;
            camera.position.z = Math.max(1.5, Math.min(10, camera.position.z));
        }

        function onCanvasClick(event) {
            if (hasDragged) return;

            if (projectGroup.visible) {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(projectGroup.children);
                if (intersects.length > 0) {
                    showProjectPopup(intersects[0].object.userData);
                }
            }
        }

        function onMouseLeave() {
            isDragging = false;
            renderer.domElement.style.cursor = 'grab';
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function getCurrentActiveContentGroup() {
            if (projectsButton.classList.contains('active')) return projectGroup;
            if (artButton.classList.contains('active')) return artGroup;
            if (aboutButton.classList.contains('active')) return aboutGroup;
            return null;
        }

        // --- UI LOGIC ---

        function setupSliderMenu() {
            const projectsButton = document.getElementById('projectsButton');
            const artButton = document.getElementById('artButton');
            const aboutButton = document.getElementById('aboutButton');

            function setActiveButton(activeButton) {
                [projectsButton, artButton, aboutButton].forEach(button => {
                    button.classList.toggle('active', button === activeButton);
                });
            }

            function handleCategoryChange(incomingGroup) {
                if (popup) {
                    popup.style.display = 'none';
                    // Reset window on category change
                    popup.style.width = "";
                    popup.style.height = "";
                    popup.style.top = "50%";
                    popup.style.left = "50%";
                    popup.style.transform = "translate(-50%, -50%)";
                }

                const tl = gsap.timeline();
                const outgoingGroup = getCurrentActiveContentGroup();
                const moveDistance = 50;

                if (outgoingGroup && outgoingGroup !== incomingGroup) {
                    tl.to(outgoingGroup.position, { y: moveDistance, duration: 0.7, ease: "power2.in" }, 0);
                    outgoingGroup.traverse(obj => {
                        if (obj.isMesh && obj.material.transparent) {
                            tl.to(obj.material, { opacity: 0, duration: 0.5, ease: "power2.in" }, 0);
                        }
                    });
                }

                tl.call(() => {
                    if (outgoingGroup && outgoingGroup !== incomingGroup) outgoingGroup.visible = false;
                    incomingGroup.visible = true;
                    incomingGroup.position.y = -moveDistance;
                }, null, outgoingGroup ? 0.6 : 0);

                tl.to(incomingGroup.position, { y: 0, duration: 0.7, ease: "power2.out" });
                incomingGroup.traverse(obj => {
                    if (obj.isMesh && obj.material.transparent) {
                        tl.to(obj.material, { opacity: 1, duration: 0.7, ease: "power2.out" }, "-=0.6");
                    }
                });
                tl.to(scene.rotation, { x: 0, y: 0, z: 0, duration: 0.7, ease: "power2.inOut"}, 0);
            }

            [ { btn: projectsButton, group: projectGroup }, { btn: artButton, group: artGroup }, { btn: aboutButton, group: aboutGroup }
            ].forEach(({btn, group}) => {
                btn.addEventListener('click', () => {
                    if(btn.classList.contains('active')) return;
                    handleCategoryChange(group);
                    setActiveButton(btn);
                });
            });

            setActiveButton(null);
        }

        function setupPopupWindow() {
            popup = document.getElementById('popup-window');
            header = document.getElementById('popup-header');
            const closeBtn = document.getElementById('popup-close');

            closeBtn.addEventListener('click', () => {
                popup.style.display = 'none';
            });

            header.addEventListener('mousedown', (e) => {
                isPopupDragging = true;
                offsetX = e.clientX - popup.offsetLeft;
                offsetY = e.clientY - popup.offsetTop;
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mouseup', () => {
                isPopupDragging = false;
                document.body.style.userSelect = 'auto';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isPopupDragging) return;
                e.preventDefault();
                popup.style.left = `${e.clientX - offsetX}px`;
                popup.style.top = `${e.clientY - offsetY}px`;
            });
        }

        function showProjectPopup(data) {
            const popupTitle = document.getElementById('popup-title');
            const popupImage = document.getElementById('popup-image');
            const popupDescription = document.getElementById('popup-description');
            const popupLinksContainer = document.getElementById('popup-links');

            popupTitle.textContent = data.title;
            popupImage.src = data.imageUrl;
            popupImage.alt = data.title;
            popupDescription.textContent = data.description;

            // Clear previous links and populate new ones
            popupLinksContainer.innerHTML = '';
            if (data.links) {
                // This map now contains the image data directly, so no external files are needed.
                const logoMap = {
                    github: 'images/icons/github.png',
                    pdf: 'images/icons/pdf.png',
                    video: 'images/icons/video.png'
                };

                for (const key in data.links) {
                    const logoType = key.replace(/\d/g, '');

                    if (logoMap[logoType]) {
                        const link = document.createElement('a');
                        link.href = data.links[key];
                        link.target = '_blank';

                        const img = document.createElement('img');
                        img.src = logoMap[logoType];
                        img.alt = `${logoType} link`;

                        link.appendChild(img);
                        popupLinksContainer.appendChild(link);
                    }
                }
            }


            if (popup.style.display !== 'flex') {
                popup.style.width = "";
                popup.style.height = "";
                popup.style.top = "50%";
                popup.style.left = "50%";
                popup.style.transform = "translate(-50%, -50%)";
            }

            popup.style.display = 'flex';
        }

        window.onload = function() {
            init();
            animate();
        };
    </script>
</body>
</html>